generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model account_balances {
  id          String     @id
  account_id  String
  currency_id String
  available   Decimal    @default(0.00000000) @db.Decimal(18, 8)
  reserved    Decimal    @default(0.00000000) @db.Decimal(18, 8)
  created_at  DateTime   @default(now())
  updated_at  DateTime
  accounts    accounts   @relation(fields: [account_id], references: [id], onDelete: Cascade)
  currencies  currencies @relation(fields: [currency_id], references: [id])

  @@unique([account_id, currency_id], map: "account_balance_unique")
  @@index([currency_id], map: "account_balances_currency_id_fkey")
}

model accounts {
  id               String             @id
  email            String             @unique
  password         String
  base_currency_id String
  created_at       DateTime           @default(now())
  account_balances account_balances[]
  currencies       currencies         @relation(fields: [base_currency_id], references: [id])
  ledger_entries   ledger_entries[]
  orders           orders[]
  positions        positions[]
  sessions         sessions[]
  transactions     transactions[]

  @@index([base_currency_id], map: "accounts_base_currency_id_fkey")
}

model currencies {
  id               String             @id
  code             String             @unique
  name             String
  symbol           String
  account_balances account_balances[]
  accounts         accounts[]
  instruments      instruments[]
  transactions     transactions[]
}

model executions {
  id                    String   @id
  order_id              String
  counterparty_order_id String?
  price                 Decimal  @db.Decimal(18, 8)
  quantity              Decimal  @db.Decimal(18, 8)
  executed_at           DateTime @default(now())
  liquidity             String?
  orders                orders   @relation(fields: [order_id], references: [id])

  @@index([order_id])
}

model instruments {
  id                 String              @id
  symbol             String              @unique
  name               String
  lot_size           Decimal             @db.Decimal(18, 8)
  tick_size          Decimal             @db.Decimal(18, 8)
  currency_id        String
  created_at         DateTime            @default(now())
  currencies         currencies          @relation(fields: [currency_id], references: [id])
  instrument_prices  instrument_prices[]
  market_quotes      market_quotes[]
  positions          positions[]

  @@index([currency_id], map: "instruments_currency_id_fkey")
}

model instrument_prices {
  id            BigInt      @id @default(autoincrement())
  instrument_id String
  timestamp     DateTime    @default(now())
  price         Decimal     @db.Decimal(18, 8)
  volume        Decimal?    @db.Decimal(18, 8)
  bid_price     Decimal?    @db.Decimal(18, 8)
  ask_price     Decimal?    @db.Decimal(18, 8)
  source        String?
  instruments   instruments @relation(fields: [instrument_id], references: [id], onDelete: Cascade)

  @@unique([instrument_id, timestamp(sort: Desc)], map: "uq_instrument_price_instrument_ts")
  @@index([instrument_id, timestamp])
}
model ledger_entries {
  id                 String             @id
  account_id         String
  entry_type_id      Int                @db.SmallInt
  amount             Decimal            @db.Decimal(18, 8)
  reference_id       String?
  reference_table    String?
  created_at         DateTime           @default(now())
  accounts           accounts           @relation(fields: [account_id], references: [id])
  ledger_entry_types ledger_entry_types @relation(fields: [entry_type_id], references: [id])

  @@index([account_id, created_at])
  @@index([entry_type_id], map: "ledger_entries_entry_type_id_fkey")
}

model ledger_entry_types {
  id             Int              @id @default(autoincrement()) @db.SmallInt
  code           String           @unique
  description    String?
  category       String?
  ledger_entries ledger_entries[]
}

model market_quotes {
  id            BigInt      @id @default(autoincrement())
  instrument_id String
  bid_price     Decimal?    @db.Decimal(18, 8)
  ask_price     Decimal?    @db.Decimal(18, 8)
  last_price    Decimal?    @db.Decimal(18, 8)
  volume        Decimal?    @db.Decimal(18, 8)
  ts            DateTime
  instruments   instruments @relation(fields: [instrument_id], references: [id])

  @@unique([instrument_id, ts(sort: Desc)], map: "uq_market_quotes_instrument_ts")
}

model order_sides {
  id          Int      @id @default(autoincrement()) @db.SmallInt
  code        String   @unique
  description String?
  orders      orders[]
}

model order_statuses {
  id          Int      @id @default(autoincrement()) @db.SmallInt
  code        String   @unique
  description String?
  orders      orders[]
}

model order_types {
  id          Int      @id @default(autoincrement()) @db.SmallInt
  code        String   @unique
  description String?
  orders      orders[]
}

model orders {
  id                  String               @id
  account_id          String
  instrument_id       String
  side_id             Int                  @db.SmallInt
  type_id             Int                  @db.SmallInt
  status_id           Int                  @db.SmallInt
  time_in_force_id    Int?                 @db.SmallInt
  client_order_id     String?              @unique
  price               Decimal?             @db.Decimal(18, 8)
  quantity            Decimal              @db.Decimal(18, 8)
  filled_quantity     Decimal              @default(0.00000000) @db.Decimal(18, 8)
  created_at          DateTime             @default(now())
  updated_at          DateTime
  remaining_quantity  Decimal?             @db.Decimal(18, 8)
  executions          executions[]
  accounts            accounts             @relation(fields: [account_id], references: [id])
  order_sides         order_sides          @relation(fields: [side_id], references: [id])
  order_statuses      order_statuses       @relation(fields: [status_id], references: [id])
  time_in_force_types time_in_force_types? @relation(fields: [time_in_force_id], references: [id])
  order_types         order_types          @relation(fields: [type_id], references: [id])

  @@index([account_id, status_id])
  @@index([instrument_id, side_id, status_id, created_at])
  @@index([side_id], map: "orders_side_id_fkey")
  @@index([status_id], map: "orders_status_id_fkey")
  @@index([time_in_force_id], map: "orders_time_in_force_id_fkey")
  @@index([type_id], map: "orders_type_id_fkey")
}

model positions {
  id            String      @id
  account_id    String
  instrument_id String
  quantity      Decimal     @db.Decimal(18, 8)
  average_price Decimal     @db.Decimal(18, 8)
  updated_at    DateTime
  accounts      accounts    @relation(fields: [account_id], references: [id])
  instruments   instruments @relation(fields: [instrument_id], references: [id])

  @@unique([account_id, instrument_id], map: "positions_account_instrument_unique")
  @@index([instrument_id], map: "positions_instrument_id_fkey")
}

model sessions {
  id         String   @id
  account_id String
  token      String   @unique
  expires_at DateTime
  created_at DateTime @default(now())
  accounts   accounts @relation(fields: [account_id], references: [id], onDelete: Cascade)

  @@index([account_id, expires_at])
  @@index([expires_at])
  @@index([token])
}

model time_in_force_types {
  id          Int      @id @default(autoincrement()) @db.SmallInt
  code        String   @unique
  description String?
  orders      orders[]
}

model transaction_statuses {
  id           Int            @id @default(autoincrement()) @db.SmallInt
  code         String         @unique
  description  String?
  transactions transactions[]
}

model transaction_types {
  id           Int            @id @default(autoincrement()) @db.SmallInt
  code         String         @unique
  description  String?
  category     String?
  transactions transactions[]
}

model transactions {
  id                   String               @id
  account_id           String
  tx_type_id           Int                  @db.SmallInt
  status_id            Int                  @db.SmallInt
  amount               Decimal              @db.Decimal(18, 8)
  external_ref         String?
  created_at           DateTime             @default(now())
  updated_at           DateTime
  currency_id          String?
  accounts             accounts             @relation(fields: [account_id], references: [id])
  currencies           currencies?          @relation(fields: [currency_id], references: [id])
  transaction_statuses transaction_statuses @relation(fields: [status_id], references: [id])
  transaction_types    transaction_types    @relation(fields: [tx_type_id], references: [id])

  @@index([account_id, created_at])
  @@index([account_id, status_id, tx_type_id])
  @@index([currency_id], map: "transactions_currency_id_fkey")
  @@index([status_id], map: "transactions_status_id_fkey")
  @@index([tx_type_id], map: "transactions_tx_type_id_fkey")
}
